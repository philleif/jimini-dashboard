extends layout

block content
  .container
    #positions
      h1 Jimini
      h2 {{ time }}
      hr
      .columns
        .column.col-4
          .centered
            h5.label Net Profit:
          #total-summary
            h1 ${{ net }}
      hr
      .columns
        .column.col-4
          h5.label Open Positions:
          ul
            open-position-list-item(v-for="position in positions.open",
              v-bind:position="position")
        .column.col-8
          h5.label Latest Closed Positions:
          ul
            closed-position-list-item(v-for="position in positions.closed",
              v-bind:position="position")

  script.
    Vue.component('open-position-list-item', {
      props: ['position'],
      template: '<li>{{ position.pair }} {{ position.amount }} @ \
        ${{ position.openPrice }} (${{ position.amount * position.openPrice }})</li>'
    })

    Vue.component('closed-position-list-item', {
      props: ['position'],
      template: "<li><small class='text-gray'> \
        {{ new Date(position.time) }}</small> <br />\
        {{ position.pair }} {{ position.amount }} @ \
        ${{ position.openPrice }}/{{ position.closePrice }} \
        (${{ Math.round(position.amount * (position.closePrice - \
        position.openPrice)) }})</div></li>"
    })

    let closedPositions = new Vue({
      el: '#positions',
      data: {
        positions: [],
        net: 0,
        interval: null,
        time: null
      },
      methods: {
        loadData: function () {
          axios.get('/positions').then(response => {
            this.positions = response.data.positions
            this.time = Date()
            this.net = 0
            for (let p of this.positions.closed) {
              this.net += Math.round(p.amount * (p.closePrice - p.openPrice))
            }
          })
        }
      },
      created: function () {
        this.loadData()

        setInterval(function () {
          this.loadData()
        }.bind(this), 2500)
      }
    })