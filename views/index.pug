extends layout

block content
  .container
    h1 Jimini
    hr
    .columns
      .column.col-4
        .centered
          h5.label Overall Performance:
        #total-summary
          h1 -
          h5 -
    hr
    .columns
      .column.col-4
        h5.label Open Positions:
        #open-positions
          ul
            open-position-list-item(v-for="position in positions",
              v-bind:position="position")
      .column.col-8
        h5.label Latest Closed Positions:
        #closed-positions
          ul
            closed-position-list-item(v-for="position in positions",
              v-bind:position="position")

  script.
    Vue.component('open-position-list-item', {
      props: ['position'],
      template: '<li>{{ position.pair }} {{ position.amount }} @ \
        ${{ position.openPrice }} (${{ position.amount * position.openPrice }})</li>'
    })

    Vue.component('closed-position-list-item', {
      props: ['position'],
      template: "<li><small class='text-gray'> \
        {{ Date(position.time) }}</small> <br />\
        {{ position.pair }} {{ position.amount }} @ \
        ${{ position.openPrice }}/{{ position.closePrice }} \
        (${{ Math.round(position.amount * (position.closePrice - \
        position.openPrice)) }})</div></li>"
    })

    let closedPositions = new Vue({
      el: '#closed-positions',
      data: {
        positions: []
      },
      methods: {
        loadData: function () {
          axios.get('/positions').then(response => {
            this.positions = response.data.positions.closed
          })
        }
      },
      created: function () {
        this.loadData()
      }
    })

    let openPositions = new Vue({
      el: '#open-positions',
      data: {
        positions: []
      },
      methods: {
        loadData: function () {
          axios.get('/positions').then(response => {
            this.positions = response.data.positions.open
          })
        }
      },
      created: function () {
        this.loadData()
      }
    })